<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat App</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        .message-enter {
            animation: fadeIn 0.3s ease-out;
        }

        .gradient-avatar {
            background: linear-gradient(45deg, #0095f6, #00cc66);
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .message-bubble {
            position: relative;
        }

        .message-bubble:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: -7px;
            width: 0;
            height: 0;
            border: 7px solid transparent;
            border-top-color: #efefef;
            border-bottom: 0;
            border-left: 0;
            margin-left: -3.5px;
            margin-bottom: -7px;
        }

        .message-bubble.you:after {
            left: auto;
            right: -7px;
            border-top-color: #d5ebff;
            border-right: 0;
        }

        .dark .message-bubble:after {
            border-top-color: #262626;
        }

        .dark .message-bubble.you:after {
            border-top-color: #00376b;
        }

        .typing-indicator {
            display: inline-flex;
            align-items: center;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background-color: #8e8e8e;
            border-radius: 50%;
            margin: 0 2px;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingAnimation {

            0%,
            60%,
            100% {
                transform: translateY(0);
            }

            30% {
                transform: translateY(-5px);
            }
        }
    </style>
</head>

<body class="font-inter bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <div class="flex justify-center items-center min-h-screen p-4">
        <div
            class="w-full max-w-md h-[90vh] max-h-[800px] bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-200 dark:border-gray-700 flex flex-col">
            <!-- Join Room Component -->
            <div id="joinRoomComponent" class="h-full flex flex-col">
                <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                    <h2 class="text-lg font-semibold text-gray-800 dark:text-white">Welcome to Chat</h2>
                    <button id="modeToggle"
                        class="w-9 h-9 rounded-full flex items-center justify-center text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>

                <div class="flex-1 flex flex-col items-center justify-center p-6 text-center">
                    <div
                        class="w-16 h-16 rounded-full gradient-avatar flex items-center justify-center text-white text-2xl mb-4">
                        <i class="fas fa-comments"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-white mb-2">Join a Chat Room</h3>
                    <p class="text-gray-500 dark:text-gray-400 mb-8">Enter your details below to start chatting with
                        others in real-time</p>

                    <div class="w-full max-w-xs space-y-4">
                        <div>
                            <input type="text" id="roomIdInput" placeholder="Room ID"
                                class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                        </div>
                        <div>
                            <input type="text" id="usernameInput" placeholder="Username"
                                class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                        </div>
                        <button id="joinRoomBtn"
                            class="w-full px-4 py-3 bg-blue-500 hover:bg-blue-600 text-white font-medium rounded-lg transition flex items-center justify-center space-x-2">
                            <span>Join Room</span>
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Chat Component -->
            <div id="chatComponent" class="hidden h-full flex flex-col">
                <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <div class="w-9 h-9 rounded-full gradient-avatar flex items-center justify-center text-white font-semibold"
                            id="userAvatar">N</div>
                        <div>
                            <h2 class="text-lg font-semibold text-gray-800 dark:text-white" id="roomTitle">Room Chat
                            </h2>
                            <div class="text-xs text-gray-500 dark:text-gray-400 flex items-center">
                                <span id="connectionStatus">Online</span>
                                <span class="mx-1">â€¢</span>
                                <span id="userCount">1 user</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button
                            class="w-9 h-9 rounded-full flex items-center justify-center text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                            <i class="fas fa-search"></i>
                        </button>
                        <button id="chatModeToggle"
                            class="w-9 h-9 rounded-full flex items-center justify-center text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                            <i class="fas fa-moon"></i>
                        </button>
                    </div>
                </div>

                <div id="messages"
                    class="flex-1 overflow-y-auto p-4 bg-gray-50 dark:bg-gray-700 scrollbar-hide space-y-4">
                    <div class="text-center text-xs text-gray-500 dark:text-gray-400 fade-in">Today</div>

                    <div class="flex items-end space-x-2 fade-in">
                        <div
                            class="w-8 h-8 rounded-full bg-purple-500 flex items-center justify-center text-white text-sm font-semibold">
                            S</div>
                        <div class="max-w-[70%]">
                            <div class="text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1">Sarah</div>
                            <div
                                class="bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-white px-4 py-2 rounded-lg rounded-bl-none message-bubble">
                                Hey there! ðŸ‘‹ How's it going?
                                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1 text-right">10:30 AM</div>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-end justify-end space-x-2 fade-in">
                        <div class="max-w-[70%]">
                            <div class="text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1 text-right">You
                            </div>
                            <div
                                class="bg-blue-100 dark:bg-blue-900 text-gray-800 dark:text-white px-4 py-2 rounded-lg rounded-br-none message-bubble you">
                                Great! Just finished the new chat UI design ðŸ˜Š
                                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1 text-right">10:32 AM <i
                                        class="fas fa-check-double text-blue-500 ml-1"></i></div>
                            </div>
                        </div>
                        <div
                            class="w-8 h-8 rounded-full gradient-avatar flex items-center justify-center text-white text-sm font-semibold">
                            N</div>
                    </div>

                    <div class="flex items-end space-x-2 fade-in">
                        <div
                            class="w-8 h-8 rounded-full bg-purple-500 flex items-center justify-center text-white text-sm font-semibold">
                            S</div>
                        <div class="max-w-[70%]">
                            <div class="text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1">Sarah</div>
                            <div
                                class="bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-white px-4 py-2 rounded-lg rounded-bl-none message-bubble">
                                That looks awesome! Can't wait to try it out ðŸš€
                                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1 text-right">10:33 AM</div>
                            </div>
                        </div>
                    </div>

                    <div id="typingIndicator" class="flex items-end space-x-2 hidden">
                        <div
                            class="w-8 h-8 rounded-full bg-purple-500 flex items-center justify-center text-white text-sm font-semibold">
                            S</div>
                        <div class="max-w-[70%]">
                            <div class="text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1">Sarah</div>
                            <div
                                class="bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-white px-4 py-2 rounded-lg rounded-bl-none w-20">
                                <div class="typing-indicator">
                                    <div class="typing-dot"></div>
                                    <div class="typing-dot"></div>
                                    <div class="typing-dot"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="text-center text-xs text-gray-500 dark:text-gray-400 fade-in">Now</div>
                </div>

                <div class="p-3 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800">
                    <div class="flex items-center space-x-2">
                        <input type="text" id="messageInput" placeholder="Type a message..."
                            class="flex-1 px-4 py-2 rounded-full border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                        <button id="sendBtn"
                            class="w-10 h-10 rounded-full bg-blue-500 hover:bg-blue-600 text-white flex items-center justify-center transition">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const socket = io("https://chat-backend-mmf7.onrender.com");
        const joinRoomComponent = document.getElementById("joinRoomComponent");
        const chatComponent = document.getElementById("chatComponent");
        const messagesDiv = document.getElementById("messages");
        const roomIdInput = document.getElementById("roomIdInput");
        const usernameInput = document.getElementById("usernameInput");
        const messageInput = document.getElementById("messageInput");
        const joinRoomBtn = document.getElementById("joinRoomBtn");
        const sendBtn = document.getElementById("sendBtn");
        const modeToggle = document.getElementById("modeToggle");
        const chatModeToggle = document.getElementById("chatModeToggle");
        const userAvatar = document.getElementById("userAvatar");
        const roomTitle = document.getElementById("roomTitle");
        const connectionStatus = document.getElementById("connectionStatus");
        const typingIndicator = document.getElementById("typingIndicator");

        let currentRoom = null;
        let username = null;
        let isTyping = false;
        let typingTimeout = null;
        let RoomData = {};

        // Toggle dark mode
        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('darkMode', document.documentElement.classList.contains('dark'));
            updateModeToggleIcons();
        }

        function updateModeToggleIcons() {
            const icon = document.documentElement.classList.contains('dark') ? 'fa-sun' : 'fa-moon';
            modeToggle.innerHTML = `<i class="fas ${icon}"></i>`;
            chatModeToggle.innerHTML = `<i class="fas ${icon}"></i>`;
        }

        modeToggle.addEventListener('click', toggleDarkMode);
        chatModeToggle.addEventListener('click', toggleDarkMode);

        // Check for saved dark mode preference
        if (localStorage.getItem('darkMode') === 'true') {
            document.documentElement.classList.add('dark');
        }
        updateModeToggleIcons();

        // Generate random avatar color
        function getAvatarColor(name) {
            const colors = [
                'bg-red-500', 'bg-blue-500', 'bg-green-500',
                'bg-yellow-500', 'bg-purple-500', 'bg-pink-500',
                'bg-indigo-500', 'bg-teal-500', 'bg-orange-500'
            ];
            const charCode = name.charCodeAt(0) || 0;
            return colors[charCode % colors.length];
        }

        function addMessage(text, sender, type = "message") {
            const isSystem = type === "system";
            const isYou = type === "you";

            const messageContainer = document.createElement("div");
            messageContainer.className = `flex items-end ${isYou ? 'justify-end' : ''} space-x-2 message-enter`;

            if (!isSystem) {
                const avatar = document.createElement("div");
                avatar.className = `w-8 h-8 rounded-full ${isYou ? 'gradient-avatar' : getAvatarColor(sender)} flex items-center justify-center text-white text-sm font-semibold`;
                avatar.textContent = sender.charAt(0).toUpperCase();
                messageContainer.appendChild(avatar);
            }

            const messageContent = document.createElement("div");
            messageContent.className = `max-w-[70%] ${isYou ? 'flex flex-col items-end' : ''}`;

            if (!isSystem) {
                const senderDiv = document.createElement("div");
                senderDiv.className = `text-xs font-semibold ${isYou ? 'text-right' : ''} text-gray-700 dark:text-gray-300 mb-1`;
                senderDiv.textContent = isYou ? "You" : sender;
                messageContent.appendChild(senderDiv);
            }

            const messageDiv = document.createElement("div");
            messageDiv.className = `${isSystem ? 'text-center text-xs text-gray-500 dark:text-gray-400' :
                `${isYou ? 'bg-blue-100 dark:bg-blue-900 rounded-lg rounded-br-none' : 'bg-gray-200 dark:bg-gray-600 rounded-lg rounded-bl-none'} px-4 py-2 text-gray-800 dark:text-white message-bubble ${isYou ? 'you' : ''}`}`;

            messageDiv.textContent = text;

            if (!isSystem) {
                const now = new Date();
                const timeString = now.getHours() + ':' + (now.getMinutes() < 10 ? '0' : '') + now.getMinutes();
                const timeDiv = document.createElement("div");
                timeDiv.className = `text-xs ${isYou ? 'text-right' : ''} text-gray-500 dark:text-gray-400 mt-1`;
                timeDiv.innerHTML = timeString + (isYou ? ' <i class="fas fa-check-double text-blue-500 ml-1"></i>' : '');
                messageDiv.appendChild(timeDiv);
            }

            messageContent.appendChild(messageDiv);
            messageContainer.appendChild(messageContent);

            messagesDiv.appendChild(messageContainer);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // Clear sample messages
        function clearMessages() {
            while (messagesDiv.firstChild) {
                messagesDiv.removeChild(messagesDiv.firstChild);
            }
        }

        // Socket events
        socket.on("connect", () => {
            clearMessages();
            addMessage("Connected to server", "System", "system");
            addMessage("Today", "System", "system");
            connectionStatus.textContent = "Online";
            connectionStatus.className = "text-green-500";

        });

        socket.on("disconnect", () => {
            connectionStatus.textContent = "Offline";
            connectionStatus.className = "text-red-500";
        });

        socket.on("messages", (data) => {
            if (Array.isArray(data)) {
                data.forEach(msg => addMessage(msg.Message, msg.Username, msg.Username === username ? "you" : "message"));
            } else {
                addMessage(data.Message, data.Username, data.Username === username ? "you" : "message");
            }
        });

        socket.on("systemMessage", (text) => addMessage(text, "System", "system"));
        socket.on("errorMessage", (text) => addMessage("Error: " + text, "System", "system"));
        socket.on("userCount", (count) => userCount.textContent = count + (count === 1 ? " user" : " users"));
        socket.on("typing", (username) => {
            if (username !== username) {
                typingIndicator.querySelector('.w-8').className = `w-8 h-8 rounded-full ${getAvatarColor(username)} flex items-center justify-center text-white text-sm font-semibold`;
                typingIndicator.querySelector('.text-xs').textContent = username;
                typingIndicator.classList.remove('hidden');
                messagesDiv.scrollTop = messagesDiv.scrollHeight;

                clearTimeout(typingTimeout);
                typingTimeout = setTimeout(() => {
                    typingIndicator.classList.add('hidden');
                }, 3000);
            }
        });

        // Join room
        joinRoomBtn.addEventListener("click", () => {
            const roomId = roomIdInput.value.trim();
            username = usernameInput.value.trim();
            if (!roomId || !username) return alert("Please fill all fields");

            currentRoom = roomId;
            socket.emit("joinRoom", roomId)
            socket.emit("userAdd", {RoomId: roomId, Username: username});


            // Update UI
            userAvatar.textContent = username.charAt(0).toUpperCase();
            roomTitle.textContent = `Room ${roomId}`;

            // Hide join and show chat
            joinRoomComponent.classList.add("hidden");
            chatComponent.classList.remove("hidden");
        });

        // Send message
        sendBtn.addEventListener("click", () => {
            const msg = messageInput.value.trim();
            if (!msg) return;

            socket.emit("messages", {
                RoomId: currentRoom,
                Username: username,
                Message: msg
            });

            messageInput.value = "";
            isTyping = false;
            socket.emit("typing", {
                RoomId: currentRoom,
                Username: username,
                isTyping: false
            });
        });

        messageInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") sendBtn.click();
        });

        messageInput.addEventListener("input", () => {
            if (!isTyping) {
                isTyping = true;
                socket.emit("typing", {
                    RoomId: currentRoom,
                    Username: username,
                    isTyping: true
                });
            }

            clearTimeout(typingTimeout);
            typingTimeout = setTimeout(() => {
                isTyping = false;
                socket.emit("typing", {
                    RoomId: currentRoom,
                    Username: username,
                    isTyping: false
                });
            }, 2000);
        });

        socket.on("usercount", (count) => {
            const userCount = document.getElementById("userCount");
            if (userCount) {
                userCount.innerHTML = `${count} users`
            }
        });

        // Initialize with sample messages
        setTimeout(() => {
            clearMessages();
            addMessage("Connected to server", "System", "system");
            addMessage("Today", "System", "system");
        }, 100);
    </script>
</body>

</html>
